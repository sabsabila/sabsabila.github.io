{"version":3,"file":"svd-js.js","sources":["../src/svd.js","../src/version.js"],"sourcesContent":["/** SVD procedure as explained in \"Singular Value Decomposition and Least Squares Solutions. By G.H. Golub et al.\"\n *\n * This procedure computes the singular values and complete orthogonal decomposition of a real rectangular matrix A:\n *    A = U * diag(q) * V(t), U(t) * U = V(t) * V = I\n * where the arrays a, u, v, q represent A, U, V, q respectively. The actual parameters corresponding to a, u, v may\n * all be identical unless withu = withv = {true}. In this case, the actual parameters corresponding to u and v must\n * differ. m >= n is assumed (with m = a.length and n = a[0].length)\n *\n *  @param a {Array} Represents the matrix A to be decomposed\n *  @param [withu] {bool} {true} if U is desired {false} otherwise\n *  @param [withv] {bool} {true} if U is desired {false} otherwise\n *  @param [eps] {Number} A constant used in the test for convergence; should not be smaller than the machine precision\n *  @param [tol] {Number} A machine dependent constant which should be set equal to B/eps0 where B is the smallest\n *    positive number representable in the computer\n *\n *  @returns {Object} An object containing:\n *    q: A vector holding the singular values of A; they are non-negative but not necessarily ordered in\n *      decreasing sequence\n *    u: Represents the matrix U with orthonormalized columns (if withu is {true} otherwise u is used as\n *      a working storage)\n *    v: Represents the orthogonal matrix V (if withv is {true}, otherwise v is not used)\n *\n */\nconst SVD = (a, withu, withv, eps, tol) => {\n  // Define default parameters\n  withu = withu !== undefined ? withu : true\n  withv = withv !== undefined ? withv : true\n  eps = eps || Math.pow(2, -52)\n  tol = 1e-64 / eps\n\n  // throw error if a is not defined\n  if (!a) {\n    throw new TypeError('Matrix a is not defined')\n  }\n\n  // Householder's reduction to bidiagonal form\n\n  const n = a[0].length\n  const m = a.length\n\n  if (m < n) {\n    throw new TypeError('Invalid matrix: m < n')\n  }\n\n  let i, j, k, l, l1, c, f, g, h, s, x, y, z\n\n  g = 0\n  x = 0\n  const e = []\n\n  const u = []\n  const v = []\n\n  const mOrN = (withu === 'f') ? m : n\n\n  // Initialize u\n  for (i = 0; i < m; i++) {\n    u[i] = new Array(mOrN).fill(0)\n  }\n\n  // Initialize v\n  for (i = 0; i < n; i++) {\n    v[i] = new Array(n).fill(0)\n  }\n\n  // Initialize q\n  const q = new Array(n).fill(0)\n\n  // Copy array a in u\n  for (i = 0; i < m; i++) {\n    for (j = 0; j < n; j++) {\n      u[i][j] = a[i][j]\n    }\n  }\n\n  for (i = 0; i < n; i++) {\n    e[i] = g\n    s = 0\n    l = i + 1\n    for (j = i; j < m; j++) {\n      s += Math.pow(u[j][i], 2)\n    }\n    if (s < tol) {\n      g = 0\n    } else {\n      f = u[i][i]\n      g = f < 0 ? Math.sqrt(s) : -Math.sqrt(s)\n      h = f * g - s\n      u[i][i] = f - g\n      for (j = l; j < n; j++) {\n        s = 0\n        for (k = i; k < m; k++) {\n          s += u[k][i] * u[k][j]\n        }\n        f = s / h\n        for (k = i; k < m; k++) {\n          u[k][j] = u[k][j] + f * u[k][i]\n        }\n      }\n    }\n    q[i] = g\n    s = 0\n    for (j = l; j < n; j++) {\n      s += Math.pow(u[i][j], 2)\n    }\n    if (s < tol) {\n      g = 0\n    } else {\n      f = u[i][i + 1]\n      g = f < 0 ? Math.sqrt(s) : -Math.sqrt(s)\n      h = f * g - s\n      u[i][i + 1] = f - g\n      for (j = l; j < n; j++) {\n        e[j] = u[i][j] / h\n      }\n      for (j = l; j < m; j++) {\n        s = 0\n        for (k = l; k < n; k++) {\n          s += u[j][k] * u[i][k]\n        }\n        for (k = l; k < n; k++) {\n          u[j][k] = u[j][k] + s * e[k]\n        }\n      }\n    }\n    y = Math.abs(q[i]) + Math.abs(e[i])\n    if (y > x) {\n      x = y\n    }\n  }\n\n  // Accumulation of right-hand transformations\n  if (withv) {\n    for (i = n - 1; i >= 0; i--) {\n      if (g !== 0) {\n        h = u[i][i + 1] * g\n        for (j = l; j < n; j++) {\n          v[j][i] = u[i][j] / h\n        }\n        for (j = l; j < n; j++) {\n          s = 0\n          for (k = l; k < n; k++) {\n            s += u[i][k] * v[k][j]\n          }\n          for (k = l; k < n; k++) {\n            v[k][j] = v[k][j] + s * v[k][i]\n          }\n        }\n      }\n      for (j = l; j < n; j++) {\n        v[i][j] = 0\n        v[j][i] = 0\n      }\n      v[i][i] = 1\n      g = e[i]\n      l = i\n    }\n  }\n\n  // Accumulation of left-hand transformations\n  if (withu) {\n    if (withu === 'f') {\n      for (i = n; i < m; i++) {\n        for (j = n; j < m; j++) {\n          u[i][j] = 0\n        }\n        u[i][i] = 1\n      }\n    }\n    for (i = n - 1; i >= 0; i--) {\n      l = i + 1\n      g = q[i]\n      for (j = l; j < mOrN; j++) {\n        u[i][j] = 0\n      }\n      if (g !== 0) {\n        h = u[i][i] * g\n        for (j = l; j < mOrN; j++) {\n          s = 0\n          for (k = l; k < m; k++) {\n            s += u[k][i] * u[k][j]\n          }\n          f = s / h\n          for (k = i; k < m; k++) {\n            u[k][j] = u[k][j] + f * u[k][i]\n          }\n        }\n        for (j = i; j < m; j++) {\n          u[j][i] = u[j][i] / g\n        }\n      } else {\n        for (j = i; j < m; j++) {\n          u[j][i] = 0\n        }\n      }\n      u[i][i] = u[i][i] + 1\n    }\n  }\n\n  // Diagonalization of the bidiagonal form\n  eps = eps * x\n  let testConvergence\n  for (k = n - 1; k >= 0; k--) {\n    for (let iteration = 0; iteration < 50; iteration++) {\n      // test-f-splitting\n      testConvergence = false\n      for (l = k; l >= 0; l--) {\n        if (Math.abs(e[l]) <= eps) {\n          testConvergence = true\n          break\n        }\n        if (Math.abs(q[l - 1]) <= eps) {\n          break\n        }\n      }\n\n      if (!testConvergence) { // cancellation of e[l] if l>0\n        c = 0\n        s = 1\n        l1 = l - 1\n        for (i = l; i < k + 1; i++) {\n          f = s * e[i]\n          e[i] = c * e[i]\n          if (Math.abs(f) <= eps) {\n            break // goto test-f-convergence\n          }\n          g = q[i]\n          q[i] = Math.sqrt(f * f + g * g)\n          h = q[i]\n          c = g / h\n          s = -f / h\n          if (withu) {\n            for (j = 0; j < m; j++) {\n              y = u[j][l1]\n              z = u[j][i]\n              u[j][l1] = y * c + (z * s)\n              u[j][i] = -y * s + (z * c)\n            }\n          }\n        }\n      }\n\n      // test f convergence\n      z = q[k]\n      if (l === k) { // convergence\n        if (z < 0) {\n          // q[k] is made non-negative\n          q[k] = -z\n          if (withv) {\n            for (j = 0; j < n; j++) {\n              v[j][k] = -v[j][k]\n            }\n          }\n        }\n        break // break out of iteration loop and move on to next k value\n      }\n\n      // Shift from bottom 2x2 minor\n      x = q[l]\n      y = q[k - 1]\n      g = e[k - 1]\n      h = e[k]\n      f = ((y - z) * (y + z) + (g - h) * (g + h)) / (2 * h * y)\n      g = Math.sqrt(f * f + 1)\n      f = ((x - z) * (x + z) + h * (y / (f < 0 ? (f - g) : (f + g)) - h)) / x\n\n      // Next QR transformation\n      c = 1\n      s = 1\n      for (i = l + 1; i < k + 1; i++) {\n        g = e[i]\n        y = q[i]\n        h = s * g\n        g = c * g\n        z = Math.sqrt(f * f + h * h)\n        e[i - 1] = z\n        c = f / z\n        s = h / z\n        f = x * c + g * s\n        g = -x * s + g * c\n        h = y * s\n        y = y * c\n        if (withv) {\n          for (j = 0; j < n; j++) {\n            x = v[j][i - 1]\n            z = v[j][i]\n            v[j][i - 1] = x * c + z * s\n            v[j][i] = -x * s + z * c\n          }\n        }\n        z = Math.sqrt(f * f + h * h)\n        q[i - 1] = z\n        c = f / z\n        s = h / z\n        f = c * g + s * y\n        x = -s * g + c * y\n        if (withu) {\n          for (j = 0; j < m; j++) {\n            y = u[j][i - 1]\n            z = u[j][i]\n            u[j][i - 1] = y * c + z * s\n            u[j][i] = -y * s + z * c\n          }\n        }\n      }\n      e[l] = 0\n      e[k] = f\n      q[k] = x\n    }\n  }\n\n  // Number below eps should be zero\n  for (i = 0; i < n; i++) {\n    if (q[i] < eps) q[i] = 0\n  }\n\n  return { u, q, v }\n}\n\nexport default SVD\n","// THIS IS AN AUTOGENERATED FILE. DO NOT EDIT THIS FILE DIRECTLY.\nexport const VERSION = '1.1.1'\n"],"names":["SVD","a","withu","withv","eps","tol","undefined","Math","pow","TypeError","n","length","m","i","j","k","l","l1","c","f","g","h","s","x","y","z","e","u","v","mOrN","Array","fill","q","sqrt","abs","testConvergence","iteration","VERSION"],"mappings":"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"}